{
  "StartAt": "ProcessFovs",
  "States": {
    "ProcessFovs": {
      "Type": "Task",
      "Resource": "arn:aws:states:::batch:submitJob",
      "ResultPath": "$.taskresult.jobDefinition.jobBatchInfo",
      "Parameters": {
        "JobDefinition": "process-fov",
        "ArrayProperties": {"Size.$": "$.num_fovs"},
        "JobName": "process-fov-batch-job",
        "JobQueue": "first-run-job-queue",
        "ContainerOverrides": {
           "Environment": [
             {"Name": "RECIPE_LOCATION", "Value.$": "$.recipe_location"},
             {"Name": "EXPERIMENT_URL", "Value.$": "$.experiment_url"},
             {"Name": "RESULTS_LOCATION", "Value.$": "$.results_location"}]
          }
         },
       "Next": "ConcatFovs"
        },
    "ConcatFovs": {
      "Type": "Task",
      "Resource": "arn:aws:states:::batch:submitJob",
      "Parameters": {
        "JobName": "merge-results-job",
        "JobQueue": "first-run-job-queue",
        "ContainerOverrides": {
           "Environment": [{"Name": "RESULTS_LOCATION", "Value.$": "$.results_location"}]
        },
        "JobDefinition": "iss-merge-job",
        "DependsOn": [{"JobId.$": "$.taskresult.jobDefinition.jobBatchInfo.JobId"}]
      },
     "End": true
    }
  }
}